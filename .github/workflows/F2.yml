# 工作流名称：X（这是一个简化的名称，建议使用更具描述性的名称）
name: X

# 工作流触发条件配置
on:
  # 定时触发 - 使用 cron 表达式
  schedule:
    # 每10分钟执行一次（分钟 小时 日 月 星期）每天3点执行
    # */10 表示每10分钟，即 0,10,20,30,40,50 分钟时执行
    - cron: "0 3 * * *"
  # 手动触发 - 允许在 GitHub 界面手动运行此工作流
  workflow_dispatch:

# 定义作业
jobs:
  # 作业名称：j1（这是一个简化的名称，建议使用更具描述性的名称）
  j1:
    # 运行环境：最新版 Ubuntu
    runs-on: ubuntu-latest
    
    # 定义作业步骤
    steps:
      # 步骤1：检出代码仓库
      # 使用官方 checkout action 将代码检出到工作目录
      - uses: actions/checkout@v3
      
      # 步骤2：执行 Python 脚本
      - name: s1  # 步骤名称
        # 设置环境变量（从 GitHub Secrets 中获取）
        env:
          # 从 secrets.fs 获取 URL 并赋值给 a1
          a1: ${{ secrets.fs }}
          # 从 secrets.ff 获取文件名并赋值给 b2
          b2: ${{ secrets.ff }}
          # 从 secrets.gu 获取 git 用户名并赋值给 c3
          c3: ${{ secrets.gu }}
          # 从 secrets.ge 获取 git 邮箱并赋值给 d4
          d4: ${{ secrets.ge }}
        # 运行 Python 脚本
        run: |
          # 导入必要的 Python 模块
          # datetime: 用于获取当前时间
          # os: 用于执行系统命令和访问环境变量
          import datetime, os
          
          # 获取当前 UTC 时间并格式化为字符串
          # 格式：年-月-日 时:分:秒 UTC
          t = datetime.datetime.utcnow().strftime('%Y-%m-%d %H:%M:%S UTC')
          
          # 创建提交信息：以"LUT-"开头，后面接去除空格和冒号的时间戳
          # 例如：LUT-2024-01-01010000UTC
          m = f"LUT-{t.replace(' ', '').replace(':','')}"
          
          # 使用 curl 下载文件：
          # -sSL 参数说明：
          #   -s: 静默模式，不显示进度或错误信息
          #   -S: 与-s一起使用时，显示错误信息
          #   -L: 跟随重定向
          # 从环境变量 a1（URL）下载文件，保存为环境变量 b2（文件名）
          os.system(f'curl -sSL "{os.environ["a1"]}" -o "{os.environ["b2"]}"')
          
          # 配置 git 全局用户名
          # 从环境变量 c3 获取用户名
          os.system(f'git config --global user.name "{os.environ["c3"]}"')
          
          # 配置 git 全局邮箱
          # 从环境变量 d4 获取邮箱
          os.system(f'git config --global user.email "{os.environ["d4"]}"')
          
          # 将下载的文件添加到 git 暂存区
          # 从环境变量 b2 获取文件名
          os.system(f'git add {os.environ["b2"]}')
          
          # 提交更改到本地仓库
          # 使用生成的消息 m 作为提交信息
          # || echo x: 如果提交失败（例如没有变化），输出 'x' 避免脚本失败
          os.system(f'git commit -m "{m}" || echo x')
          
          # 推送更改到远程仓库
          os.system('git push')
          
          # 打印提交消息，便于在 GitHub Actions 日志中查看
          print(f"MSG:{m}")
        # 指定使用 Python 解释器执行脚本
        shell: python
