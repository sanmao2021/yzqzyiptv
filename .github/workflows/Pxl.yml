# 工作流名称
name: Update Playlist

# 触发条件配置
on:
  # 定时任务触发
  schedule:
    # cron表达式：每30分钟执行一次，每天5点执行
    - cron: "0 5 * * *" 
  # 手动触发配置
  workflow_dispatch:       

# 定义工作流中的任务
jobs:
  # 任务名称
  update-playlist:
    # 指定运行环境：最新版Ubuntu
    runs-on: ubuntu-latest

    # 定义任务步骤
    steps:
      # 步骤1：检出代码仓库
      - name: Checkout repository
        # 使用官方checkout action（v4版本）
        uses: actions/checkout@v4

      # 步骤2：设置Python环境
      - name: Set up Python
        # 使用官方setup-python action（v5版本）
        uses: actions/setup-python@v5
        with:
          # 指定Python版本（使用最新的3.x版本）
          python-version: '3.x'

      # 步骤3：安装Python依赖
      - name: Install dependencies
        # 使用pip安装requests库
        run: pip install requests

      # 步骤4：运行Python脚本
      - name: Run tvpass.py
        # 执行名为pxs.py的Python脚本
        run: python pxs.py

      # 步骤5：提交文件变更（如果有）
      - name: Commit changes if any
        # 多行命令开始
        run: |
          # 配置Git用户名（从secrets中读取）
          git config user.name "${{ secrets.GIT_U }}"
          # 配置Git邮箱（从secrets中读取）
          git config user.email "${{ secrets.GIT_E }}"
          # 将Pixelsports.m3u文件添加到暂存区
          git add Pixelsports.m3u
          # 检查是否有文件被修改（有变更才提交）
          # git diff --cached 查看暂存区变更
          # --quiet 表示安静模式，有变更返回false
          # || 表示如果左边命令失败（有变更）则执行右边命令
          git diff --cached --quiet || git commit -m "auto-update TVPass.m3u"
          # 推送提交到远程仓库
          git push
