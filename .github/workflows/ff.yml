# 工作流名称：X（可能是一个简化或匿名的名称）
name: X

# 触发条件
on:
  # 定时触发 - 每小时的第0分钟执行一次（即每小时整点运行），每天7点执行1次
  schedule:
    - cron: "0 7 * * *"
  # 手动触发 - 在 GitHub 仓库页面可以手动运行
  workflow_dispatch:

# 定义工作流中的任务
jobs:
  # 任务名称：j1（可能是 job1 的缩写）
  j1:
    # 指定运行环境：最新版的 Ubuntu
    runs-on: ubuntu-latest
    
    # 任务步骤
    steps:
      # 步骤1：检出代码库
      - uses: actions/checkout@v3
      
      # 步骤2：执行Python脚本
      - name: s1（可能是 step1 的缩写）
        # 设置环境变量，从 GitHub Secrets 中获取敏感信息
        env:
          a1: ${{ secrets.fu }}   # 可能存储文件URL（file URL）
          b2: ${{ secrets.ffn }}  # 可能存储文件名（file name）
          c3: ${{ secrets.gu }}   # 可能存储git用户名（git username）
          d4: ${{ secrets.ge }}   # 可能存储git邮箱（git email）
        # 使用python作为shell执行多行命令
        run: |
          # 导入必要的Python模块
          import datetime, os
          
          # 获取当前UTC时间并格式化为字符串
          t = datetime.datetime.utcnow().strftime('%Y-%m-%d %H:%M:%S UTC')
          # 创建提交信息：LUT-加去除空格和冒号的时间戳
          m = f"LUT-{t.replace(' ', '').replace(':','')}"
          
          # 使用curl从a1环境变量指定的URL下载文件，保存为b2环境变量指定的文件名
          os.system(f'curl -sSL "{os.environ["a1"]}" -o "{os.environ["b2"]}"')
          
          # 配置git用户名和邮箱
          os.system(f'git config --global user.name "{os.environ["c3"]}"')
          os.system(f'git config --global user.email "{os.environ["d4"]}"')
          
          # 将下载的文件添加到git暂存区
          os.system(f'git add {os.environ["b2"]}')
          
          # 提交更改，如果失败则输出'x'（|| 表示前一个命令失败才执行后一个）
          os.system(f'git commit -m "{m}" || echo x')
          
          # 推送更改到远程仓库
          os.system('git push')
          
          # 打印提交信息，可能在GitHub Actions日志中显示
          print(f"MSG:{m}")
        # 指定使用python作为shell执行上面的代码（而不是默认的bash）
        shell: python
