name: 测试 Secrets 是否正确设置

on: workflow_dispatch

jobs:
  test-secrets:
    runs-on: ubuntu-latest

    steps:
      - name: 检查所有 Secrets
        run: |
          echo "=== 检查 Secrets 是否设置 ==="
          
          echo "1. 使用环境变量方式检查:"
          if [ -n "${{ secrets.url }}" ]; then
            echo "✓ url: 已设置 (长度: ${#{{ secrets.url }}} 字符)"
          else
            echo "✗ url: 未设置"
          fi
          
          if [ -n "${{ secrets.filename }}" ]; then
            echo "✓ filename: 已设置 (内容: ${{ secrets.filename }})"
          else
            echo "✗ filename: 未设置"
          fi
          
          if [ -n "${{ secrets.git_user }}" ]; then
            echo "✓ git_user: 已设置 (内容: ${{ secrets.git_user }})"
          else
            echo "✗ git_user: 未设置"
          fi
          
          if [ -n "${{ secrets.git_email }}" ]; then
            echo "✓ git_email: 已设置 (内容: ${{ secrets.git_email }})"
          else
            echo "✗ git_email: 未设置"
          fi
          
          echo ""
          echo "=== 测试 Python 中的环境变量 ==="
          
          python3 << 'EOF'
          import os
          
          print("2. Python 环境变量检查:")
          env_vars = ['url', 'filename', 'git_user', 'git_email']
          
          for var in env_vars:
              value = os.environ.get(var)
              if value:
                  print(f"✓ {var}: 已设置")
                  if var == 'filename':
                      print(f"   内容: {value}")
                  elif var == 'url':
                      print(f"   前50字符: {value[:50]}...")
                  else:
                      print(f"   内容: {value}")
              else:
                  print(f"✗ {var}: 未设置")
          
          print("\n=== 原始工作流中的获取方式 ===")
          print("3. 模拟工作流中的获取方式:")
          
          download_pairs = [
              (os.environ.get("url"), os.environ.get("filename")),
          ]
          
          for i, (url, filename) in enumerate(download_pairs):
              print(f"下载对 #{i+1}:")
              print(f"  URL: {'有值' if url else '空'}")
              print(f"  文件名: {filename if filename else '空'}")
              
              if not url or not filename:
                  print("  ⚠ 此对将被跳过！")
          EOF
