# 工作流名称：X（使用匿名名称，可能为了保密或简化）
name: X

# 触发条件
on:
  # 定时触发 - 每小时的第0分钟执行一次（每小时整点运行）,每12小时执行1次
  schedule:
    - cron: "0 */12 * * *"
  # 手动触发 - 可在 GitHub 仓库页面手动运行此工作流
  workflow_dispatch:

# 定义工作流中的任务
jobs:
  # 任务名称：j1（可能表示 job1）
  j1:
    # 指定运行环境：最新版的 Ubuntu 系统
    runs-on: ubuntu-latest
    # 任务步骤
    steps:
      # 步骤1：检出代码库（使用 checkout action v3 版本）
      - uses: actions/checkout@v3
      
      # 步骤2：执行名为 s1（可能表示 step1）的操作
      - name: s1
        # 设置环境变量，从 GitHub Secrets 中获取敏感信息
        env:
          # a1: 存储源 URL（source URL），可能是需要下载的文件链接
          a1: ${{ secrets.s }}
          # b2: 存储文件名（file name），下载后保存的文件名
          b2: ${{ secrets.f }}
          # c3: 存储 git 用户名（git username）
          c3: ${{ secrets.gu }}
          # d4: 存储 git 邮箱（git email）
          d4: ${{ secrets.ge }}
        # 使用 Python 作为 shell 执行以下多行命令
        run: |
          # 导入 datetime 和 os 模块
          import datetime, os
          
          # 获取当前 UTC 时间并格式化为 '年-月-日 时:分:秒 UTC' 的字符串
          t = datetime.datetime.utcnow().strftime('%Y-%m-%d %H:%M:%S UTC')
          # 创建提交消息：以 "LUT-" 开头，后接去除空格和冒号的时间戳
          m = f"LUT-{t.replace(' ', '').replace(':','')}"
          
          # 使用 curl 命令从环境变量 a1 指定的 URL 下载文件
          # -sSL 参数：静默模式、跟随重定向、显示错误信息
          # -o 参数：指定输出文件名（从环境变量 b2 获取）
          os.system(f'curl -sSL "{os.environ["a1"]}" -o "{os.environ["b2"]}"')
          
          # 配置全局 git 用户名（从环境变量 c3 获取）
          os.system(f'git config --global user.name "{os.environ["c3"]}"')
          # 配置全局 git 邮箱（从环境变量 d4 获取）
          os.system(f'git config --global user.email "{os.environ["d4"]}"')
          
          # 将下载的文件（文件名来自环境变量 b2）添加到 git 暂存区
          os.system(f'git add {os.environ["b2"]}')
          
          # 提交更改，提交消息为 m
          # 如果提交失败（例如没有变更），则执行 echo x 输出 'x'
          os.system(f'git commit -m "{m}" || echo x')
          
          # 推送更改到远程仓库
          os.system('git push')
          
          # 打印提交消息，可能在 GitHub Actions 日志中显示
          print(f"MSG:{m}")
        # 指定使用 Python 作为 shell 执行上述代码
        shell: python
